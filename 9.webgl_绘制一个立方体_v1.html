<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <script src="./js/WebGL.js"></script>
  <body>
    <script type="module">
      import WebGL from "./js/WebGL.js";
      const webgl = new WebGL("canvas");

      /**
       * 屏幕上并不是“有透视/相机”的立方体，而是一个被“拍扁”到平面的红色实心正方形。
       *
       * 顶点着色器直接输出 gl_Position = a_Position，输入被当作裁剪空间坐标使用，相当于把几何体做了对 x‑y 平面的正交投影；没有相机、没有投影矩阵。
       * 你的立方体点分两层：z=0 与 z=0.5。投影后这两层在屏幕上完全重合成同一个正方形。
       * 侧面由跨不同 z 的顶点组成，投影到 x‑y 后变成零面积三角形，几乎不产生片元，可视上等同于没有。
       * 未开启深度测试，后画的三角形覆盖先画的；前后两面又是同一纯红色，最终只看到一个红色方块。
       * 因为片元颜色恒定、无法线/光照，缺乏明暗与遮挡信息，更不会呈现立体感。
       *
       */
      // 创建立方体的着色器程序
      const programCube = webgl.useProgram(
        `#version 300 es

        layout(location = 0) in vec4 a_Position;
        void main() {
          gl_Position = a_Position;
        }
      `,
        `#version 300 es
        precision mediump float;
        out vec4 fragColor;
        void main() {
          fragColor = vec4(1.0, 0.0, 0.0, 1.0);
        }
        `
      );
      // 创建立方体缓冲区
      /**
       * 6 7
       * 4 5
       *
       * 3 2
       * 0 1
       *
       * */
      const vertexPosition = new Float32Array(
        [
          [-0.5, -0.5, 0.0], // 0
          [0.5, -0.5, 0.0], // 1
          [0.5, 0.5, 0.0], // 2
          [-0.5, 0.5, 0.0], // 3

          [-0.5, -0.5, 0.5], // 4
          [0.5, -0.5, 0.5], // 5
          [0.5, 0.5, 0.5], // 6
          [-0.5, 0.5, 0.5], // 7
        ].flat()
      );

      // 创建立方体缓冲区
      const cubeBufferId = webgl.gl.createBuffer();
      webgl.gl.bindBuffer(webgl.gl.ARRAY_BUFFER, cubeBufferId);
      webgl.gl.bufferData(
        webgl.gl.ARRAY_BUFFER,
        vertexPosition,
        webgl.gl.STATIC_DRAW
      );
      webgl.gl.vertexAttribPointer(0, 3, webgl.gl.FLOAT, false, 0, 0);
      webgl.gl.enableVertexAttribArray(0);

      // 创建索引缓冲区
      const IndexData = new Uint16Array(
        [
          [0, 1, 4, 1, 4, 5],
          [1, 5, 7, 1, 2, 7],
          [2, 3, 6, 2, 3, 7],
          [0, 3, 4, 3, 4, 6],
          [4, 5, 6, 5, 6, 7],
          [0, 3, 1, 1, 2, 3],
        ].flat()
      );

      // 创建索引缓冲区
      const IndexBufferId = webgl.gl.createBuffer();
      webgl.gl.bindBuffer(webgl.gl.ELEMENT_ARRAY_BUFFER, IndexBufferId);
      webgl.gl.bufferData(
        webgl.gl.ELEMENT_ARRAY_BUFFER,
        IndexData,
        webgl.gl.STATIC_DRAW
      );

      // 清屏颜色
      webgl.gl.clearColor(0, 0, 0, 0);
      webgl.gl.clear(webgl.gl.COLOR_BUFFER_BIT);

      // 绘制
      webgl.gl.drawElements(
              webgl.gl.TRIANGLES,
              IndexData.length,
              webgl.gl.UNSIGNED_SHORT,
              0
      );

      //
    </script>
  </body>
</html>
